<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Adventure</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- è¼‰å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- è¼‰å…¥ html2canvas ç”¨æ–¼åŒ¯å‡ºåœ–ç‰‡ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç¤ºçµ„ä»¶ (SVG) ---
        const IconBase = ({ d, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const BookOpen = (props) => <IconBase {...props} d={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />;
        const CheckCircle = (props) => <IconBase {...props} d={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />;
        const ArrowRight = (props) => <IconBase {...props} d={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />;
        const Home = (props) => <IconBase {...props} d={<><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} />;
        const Star = (props) => <IconBase {...props} d={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />;
        const RefreshCw = (props) => <IconBase {...props} d={<><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>} />;
        const Download = (props) => <IconBase {...props} d={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>} />;
        const User = (props) => <IconBase {...props} d={<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />;
        const Edit = (props) => <IconBase {...props} d={<><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></>} />;
        const Bell = (props) => <IconBase {...props} d={<><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></>} />;

        // --- è³‡æ–™çµæ§‹ ---
        const grammarData = {
            present: {
                title: "ç¾åœ¨ç°¡å–®å¼ (Present Simple)",
                icon: "â˜€ï¸",
                color: "bg-yellow-100",
                borderColor: "border-yellow-400",
                btnColor: "bg-yellow-400 hover:bg-yellow-500",
                progressColor: "bg-yellow-500",
                textColor: "text-yellow-800",
                rules: [
                    { title: "ä½¿ç”¨æ™‚æ©Ÿ", content: "äº‹å¯¦ã€ç¿’æ…£ã€æ™®éçœŸç†ï¼Œæˆ–é å®šçš„è¡Œç¨‹ã€‚", example: "I walk to work. (æˆ‘èµ°è·¯å»ä¸Šç­)" },
                    { title: "He / She / It çš„ç§˜å¯†", content: "ç•¶ä¸»è©æ˜¯ç¬¬ä¸‰äººç¨±å–®æ•¸ (He, She, It) æ™‚ï¼Œå‹•è©å­—å°¾è¦åŠ  -s æˆ– -es å–”ï¼", example: "She walks to work. (å¥¹èµ°è·¯å»ä¸Šç­)" },
                    { title: "å¦å®šå¥æ€éº¼è®Šï¼Ÿ", content: "I/You/We/They ç”¨ 'do not (don't)'ã€‚\nHe/She/It ç”¨ 'does not (doesn't)'ã€‚", example: "We don't walk. / He doesn't walk." }
                ],
                questions: [
                    { q: "I __________ (not / drink) coffee in the morning.", a: "do not drink", alt: ["don't drink"] },
                    { q: "She __________ (play) the piano beautifully.", a: "plays" },
                    { q: "They __________ (not / live) in London anymore.", a: "do not live", alt: ["don't live"] },
                    { q: "It __________ (rain) a lot during the winter here.", a: "rains" },
                    { q: "You __________ (always / forget) your keys on the table.", a: "always forget" },
                    { q: "He __________ (not / like) spicy food.", a: "does not like", alt: ["doesn't like"] },
                    { q: "We __________ (study) English every Tuesday.", a: "study" }
                ]
            },
            past: {
                title: "éå»ç°¡å–®å¼ (Past Simple)",
                icon: "ğŸ•°ï¸",
                color: "bg-blue-100",
                borderColor: "border-blue-400",
                btnColor: "bg-blue-400 hover:bg-blue-500",
                progressColor: "bg-blue-500",
                textColor: "text-blue-800",
                rules: [
                    { title: "ä½¿ç”¨æ™‚æ©Ÿ", content: "åœ¨éå»ç‰¹å®šæ™‚é–“é»é–‹å§‹ä¸¦å·²å®Œæˆçš„å‹•ä½œã€‚", example: "They cooked dinner. (ä»–å€‘ç…®äº†æ™šé¤)" },
                    { title: "å¦å®šå¥çš„å°é™·é˜±", content: "å¦å®šå¥ä½¿ç”¨ did not (didn't) + åŸå½¢å‹•è©ï¼åƒè¬ä¸è¦åŠ  ed å–”ï¼", example: "It did not cook dinner. (å®ƒæ²’ç…®æ™šé¤ - æ­£ç¢º)\nIt did not cooked... (éŒ¯èª¤ âŒ)" }
                ],
                questions: [
                    { q: "I __________ (see) a movie last night.", a: "saw" },
                    { q: "You __________ (not / call) me yesterday.", a: "did not call", alt: ["didn't call"] },
                    { q: "He __________ (buy) a new car last week.", a: "bought" },
                    { q: "They __________ (not / finish) their homework on time.", a: "did not finish", alt: ["didn't finish"] },
                    { q: "It __________ (be) very cold two days ago.", a: "was" },
                    { q: "We __________ (not / go) to the beach because of the rain.", a: "did not go", alt: ["didn't go"] },
                    { q: "She __________ (tell) me a secret this morning.", a: "told" }
                ]
            },
            future: {
                title: "æœªä¾†ç°¡å–®å¼ (Future Simple)",
                icon: "ğŸš€",
                color: "bg-green-100",
                borderColor: "border-green-400",
                btnColor: "bg-green-400 hover:bg-green-500",
                progressColor: "bg-green-500",
                textColor: "text-green-800",
                rules: [
                    { title: "ä½¿ç”¨æ™‚æ©Ÿ", content: "æ‰¿è«¾ã€é æ¸¬ï¼Œæˆ–æ˜¯èªªè©±ç•¶ä¸‹æ‰€åšçš„æ±ºå®šã€‚", example: "I will travel soon. (æˆ‘å¾ˆå¿«å°±æœƒå»æ—…è¡Œ)" },
                    { title: "å¦å®šå¥èˆ‡ç¸®å¯«", content: "will not å¯ä»¥ç¸®å¯«æˆ won'tã€‚", example: "They will not (won't) travel." }
                ],
                questions: [
                    { q: "I promise I __________ (help) you with your project tomorrow.", a: "will help" },
                    { q: "They __________ (not / arrive) before 8:00 PM.", a: "will not arrive", alt: ["won't arrive"] },
                    { q: "It __________ (be) a sunny day on Sunday.", a: "will be" },
                    { q: "You __________ (not / regret) this decision.", a: "will not regret", alt: ["won't regret"] },
                    { q: "We __________ (travel) to Japan next summer.", a: "will travel" },
                    { q: "He __________ (not / join) us for dinner tonight.", a: "will not join", alt: ["won't join"] },
                    { q: "She __________ (be) a great doctor one day.", a: "will be" }
                ]
            },
            mixed: {
                title: "æ··åˆæ™‚æ…‹æŒ‘æˆ° (Mixed Challenge)",
                icon: "ğŸ†",
                color: "bg-purple-100",
                borderColor: "border-purple-400",
                btnColor: "bg-purple-400 hover:bg-purple-500",
                progressColor: "bg-purple-500",
                textColor: "text-purple-800",
                rules: [
                    { title: "å¤§é­”ç‹é—œå¡", content: "é€™è£¡æ··åˆäº†æ‰€æœ‰æ™‚æ…‹ï¼è«‹ä»”ç´°çœ‹æ™‚é–“é—œéµå­— (Time Markers)ã€‚", example: "yesterday (éå»), always (ç¾åœ¨ç¿’æ…£), next year (æœªä¾†)" }
                ],
                questions: [
                    { q: "Last year, I __________ (travel) to France.", a: "traveled", alt: ["travelled"] },
                    { q: "Every morning, he __________ (eat) breakfast at 7 AM.", a: "eats" },
                    { q: "I think it __________ (snow) tomorrow.", a: "will snow" },
                    { q: "We __________ (not / see) that movie yet, but we saw the trailer yesterday.", a: "have not seen", alt: ["haven't seen", "did not see", "didn't see"] },
                    { q: "They __________ (not / play) football every weekend; they prefer tennis.", a: "do not play", alt: ["don't play"] },
                    { q: "She __________ (not / come) to the party last night.", a: "did not come", alt: ["didn't come"] }
                ]
            }
        };

        // --- å…ƒä»¶ ---

        const CartoonCard = ({ children, color, borderColor, className = "" }) => (
            <div className={`${color} border-4 ${borderColor} rounded-3xl shadow-[8px_8px_0px_0px_rgba(0,0,0,0.15)] p-6 transition-transform hover:-translate-y-1 ${className}`}>
                {children}
            </div>
        );

        const Button = ({ onClick, children, colorClass, className = "" }) => (
            <button
                onClick={onClick}
                className={`${colorClass} text-white font-bold py-3 px-6 rounded-2xl shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2 ${className}`}
            >
                {children}
            </button>
        );

        const FeedbackModal = ({ isCorrect, correctAnswer, onNext }) => (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-in fade-in duration-200">
                <div className={`bg-white rounded-3xl p-8 max-w-sm w-full text-center border-b-8 ${isCorrect ? 'border-green-500' : 'border-red-500'} shadow-2xl scale-100 animate-in zoom-in-95 duration-200`}>
                    <div className="text-6xl mb-4 animate-bounce">
                        {isCorrect ? 'ğŸ‰' : 'ğŸ¤”'}
                    </div>
                    <h3 className={`text-2xl font-black mb-2 ${isCorrect ? 'text-green-600' : 'text-red-600'}`}>
                        {isCorrect ? 'ç­”å°äº†ï¼ Awesome!' : 'å·®ä¸€é»é»ï¼'}
                    </h3>
                    {!isCorrect && (
                        <div className="mb-6 bg-red-50 p-4 rounded-xl text-left">
                            <p className="text-sm text-gray-500 font-bold mb-1">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
                            <p className="text-xl font-bold text-red-600">{correctAnswer}</p>
                        </div>
                    )}
                    <Button 
                        onClick={onNext} 
                        colorClass={isCorrect ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-500 hover:bg-gray-600'}
                        className="w-full text-lg"
                    >
                        {isCorrect ? 'ä¸‹ä¸€é¡Œ Next!' : 'æˆ‘çŸ¥é“äº† Got it!'}
                    </Button>
                </div>
            </div>
        );

        // --- ä¸»ç¨‹å¼ ---

        function App() {
            // ç‹€æ…‹ç®¡ç†
            const [userName, setUserName] = useState("");
            const [showNameModal, setShowNameModal] = useState(true);
            const [sectionProgress, setSectionProgress] = useState({
                present: 0,
                past: 0,
                future: 0,
                mixed: 0
            });
            const [currentSection, setCurrentSection] = useState(null); 
            const [mode, setMode] = useState(null);
            const [currentQuestionIdx, setCurrentQuestionIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [userInput, setUserInput] = useState("");
            const [showFeedback, setShowFeedback] = useState(false);
            const [lastResult, setLastResult] = useState(null);
            const [completed, setCompleted] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [notification, setNotification] = useState(null); // æ–°å¢ï¼šé€šçŸ¥è¨Šæ¯ç‹€æ…‹
            const reportRef = useRef(null);

            // è™•ç†é–‹å§‹æ¸¬é©—
            const handleSectionSelect = (sectionKey) => {
                setCurrentSection(sectionKey);
                setMode(null);
                resetQuiz();
            };

            // é‡ç½®æ¸¬é©—
            const resetQuiz = () => {
                setCurrentQuestionIdx(0);
                setScore(0);
                setCompleted(false);
                setUserInput("");
                setShowFeedback(false);
            };

            // é–‹å§‹ Quiz æ¨¡å¼
            const startQuiz = () => {
                setMode('quiz');
                resetQuiz();
            };

            // æª¢æŸ¥ç­”æ¡ˆ
            const checkAnswer = () => {
                if (!userInput.trim()) return;

                const currentQ = grammarData[currentSection].questions[currentQuestionIdx];
                const userClean = userInput.trim().toLowerCase();
                const isCorrect = userClean === currentQ.a.toLowerCase() || (currentQ.alt && currentQ.alt.includes(userClean));

                if (isCorrect) setScore(s => s + 1);

                setLastResult({ correct: isCorrect, answer: currentQ.a });
                setShowFeedback(true);
            };

            // ä¸‹ä¸€é¡Œ
            const nextQuestion = () => {
                setShowFeedback(false);
                setUserInput("");
                
                if (currentQuestionIdx < grammarData[currentSection].questions.length - 1) {
                    setCurrentQuestionIdx(prev => prev + 1);
                } else {
                    // æ¸¬é©—çµæŸ
                    setCompleted(true);
                    // ä¿®æ­£ï¼šç›´æ¥ä½¿ç”¨æœ€æ–°çš„ score æ›´æ–°é€²åº¦ï¼Œé¿å…é‡è¤‡è¨ˆç®—
                    setSectionProgress(prev => ({
                        ...prev,
                        [currentSection]: Math.max(prev[currentSection], score)
                    }));
                }
            };

            // è™•ç†å›åˆ°é¦–é  (åŒ…å«ä¸‹ä¸€é—œæé†’)
            const handleGoHome = () => {
                if (completed) {
                    // æ‰¾å‡ºä¸‹ä¸€å€‹é—œå¡
                    const sections = Object.keys(grammarData);
                    const currentIndex = sections.indexOf(currentSection);
                    
                    if (currentIndex < sections.length - 1) {
                        const nextKey = sections[currentIndex + 1];
                        const nextTitle = grammarData[nextKey].title;
                        setNotification(`å¤ªæ£’äº†ï¼æ¥ä¸‹ä¾†æŒ‘æˆ°ã€Œ${nextTitle}ã€å§ï¼ğŸ‘‰`);
                    } else {
                        setNotification("æ­å–œï¼ä½ å·²ç¶“å®Œæˆæ‰€æœ‰èª²ç¨‹äº†ï¼ğŸ“");
                    }
                    // 5ç§’å¾Œè‡ªå‹•é—œé–‰é€šçŸ¥
                    setTimeout(() => setNotification(null), 5000);
                }
                
                setCurrentSection(null);
                setMode(null);
            };

            // è™•ç†åå­—è¼¸å…¥
            const handleNameSubmit = (e) => {
                e.preventDefault();
                if (userName.trim()) {
                    setShowNameModal(false);
                }
            };

            // åŒ¯å‡ºåœ–ç‰‡
            const exportResult = async () => {
                if (!reportRef.current) return;
                setIsExporting(true);
                
                try {
                    const canvas = await html2canvas(reportRef.current, {
                        scale: 2, // æé«˜è§£æåº¦
                        backgroundColor: null,
                    });
                    
                    const link = document.createElement('a');
                    link.download = `Grammar_Adventure_${userName}_${currentSection}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error("Export failed:", err);
                    alert("åŒ¯å‡ºåœ–ç‰‡å¤±æ•—ï¼Œè«‹é‡è©¦æˆ–æˆªåœ–ä¿å­˜ï¼");
                } finally {
                    setIsExporting(false);
                }
            };

            // --- æ­¡è¿è¼¸å…¥åå­—è¦–çª— ---
            if (showNameModal) {
                return (
                    <div className="fixed inset-0 bg-orange-50 z-50 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full border-4 border-orange-200 text-center">
                            <span className="text-6xl mb-4 block">ğŸ‘‹</span>
                            <h2 className="text-3xl font-black text-orange-600 mb-2">Welcome!</h2>
                            <p className="text-gray-500 mb-6">æ­¡è¿ä¾†åˆ° Grammar Adventureï¼Œè«‹å•ä½ å«ä»€éº¼åå­—ï¼Ÿ</p>
                            <form onSubmit={handleNameSubmit}>
                                <input
                                    type="text"
                                    value={userName}
                                    onChange={(e) => setUserName(e.target.value)}
                                    placeholder="Enter your name"
                                    className="w-full text-center text-xl p-3 border-b-4 border-gray-300 focus:border-orange-500 outline-none bg-gray-50 rounded-t-lg mb-6 transition-colors"
                                    autoFocus
                                    required
                                />
                                <Button className="w-full text-lg" colorClass="bg-orange-500 hover:bg-orange-600">
                                    é–‹å§‹å†’éšª Start!
                                </Button>
                            </form>
                        </div>
                    </div>
                );
            }

            // --- é¦–é  (Dashboard) ---
            if (!currentSection) {
                return (
                    <div className="min-h-screen bg-orange-50 font-sans p-4 md:p-8 relative">
                        {/* æé†’é€šçŸ¥ Banner */}
                        {notification && (
                            <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg z-50 flex items-center gap-2 animate-[slideDown_0.5s_ease-out]">
                                <Bell className="w-5 h-5" />
                                <span className="font-bold">{notification}</span>
                                <button onClick={() => setNotification(null)} className="ml-2 hover:bg-green-600 rounded-full p-1">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                        )}

                        <div className="max-w-4xl mx-auto">
                            <header className="text-center mb-12">
                                <h1 className="text-4xl md:text-6xl font-black text-orange-600 mb-4 drop-shadow-md tracking-tight">
                                    Grammar Adventure
                                </h1>
                                <p className="text-xl text-gray-600 font-medium">Hi, <span className="text-orange-600 font-bold border-b-2 border-orange-300">{userName}</span>! æº–å‚™å¥½å¾æœè‹±æ–‡æ™‚æ…‹äº†å—ï¼ŸğŸš€</p>
                                <button onClick={() => setShowNameModal(true)} className="text-sm text-gray-400 mt-2 hover:text-orange-500 underline">
                                    ä¿®æ”¹åå­—
                                </button>
                            </header>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {Object.entries(grammarData).map(([key, data]) => {
                                    // è¨ˆç®—é€²åº¦ç™¾åˆ†æ¯”
                                    const progress = (sectionProgress[key] / data.questions.length) * 100;
                                    
                                    return (
                                        <button
                                            key={key}
                                            onClick={() => handleSectionSelect(key)}
                                            className={`group relative overflow-hidden ${data.color} border-4 ${data.borderColor} rounded-3xl p-6 text-left transition-all hover:scale-[1.02] active:scale-95 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.1)]`}
                                        >
                                            <div className="flex justify-between items-start mb-4">
                                                <span className="text-5xl group-hover:animate-bounce">{data.icon}</span>
                                                <div className="text-right">
                                                    <ArrowRight className={`w-8 h-8 ${data.textColor} opacity-0 group-hover:opacity-100 transition-opacity inline-block`} />
                                                </div>
                                            </div>
                                            <h2 className={`text-2xl font-bold ${data.textColor} mb-2`}>{data.title}</h2>
                                            
                                            {/* é€²åº¦æ¢å€åŸŸ */}
                                            <div className="mt-4 bg-white/50 rounded-full h-3 overflow-hidden border border-white/30">
                                                <div 
                                                    className={`h-full ${data.progressColor} transition-all duration-1000 ease-out`}
                                                    style={{ width: `${progress}%` }}
                                                ></div>
                                            </div>
                                            <div className="flex justify-between mt-1">
                                                <p className={`${data.textColor} text-xs font-bold opacity-70`}>æœ€ä½³æˆç¸¾: {sectionProgress[key]}/{data.questions.length}</p>
                                                <p className={`${data.textColor} text-xs font-bold opacity-70`}>{Math.round(progress)}% å®Œæˆ</p>
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>

                            <footer className="mt-16 text-center text-gray-400 font-medium">
                                <p>Designed for fun learning! âœ¨</p>
                            </footer>
                        </div>
                    </div>
                );
            }

            const sectionData = grammarData[currentSection];

            // --- æ¸¬é©—é é¢ ---
            return (
                <div className={`min-h-screen ${sectionData.color} font-sans p-4 md:p-8 transition-colors duration-500`}>
                    <div className="max-w-3xl mx-auto">
                        <div className="flex items-center justify-between mb-8 bg-white/60 backdrop-blur-sm p-4 rounded-2xl border-2 border-white/50">
                            <button 
                                onClick={handleGoHome}
                                className="flex items-center gap-2 text-gray-600 font-bold hover:text-gray-900 transition-colors"
                            >
                                <Home className="w-5 h-5" /> å›é¦–é 
                            </button>
                            <h2 className={`text-xl md:text-2xl font-black ${sectionData.textColor} text-center hidden md:block`}>
                                {sectionData.title}
                            </h2>
                            <div className="w-24 text-right font-bold text-gray-500 flex items-center justify-end gap-2">
                                <User size={16}/> {userName}
                            </div>
                        </div>

                        {!mode && (
                            <div className="flex flex-col gap-6 animate-in slide-in-from-bottom-8 duration-500">
                                <div className="text-center mb-4">
                                    <span className="text-8xl block mb-4 animate-pulse">{sectionData.icon}</span>
                                    <h2 className={`text-3xl font-black ${sectionData.textColor}`}>æº–å‚™å¥½é–‹å§‹äº†å—ï¼Ÿ</h2>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <CartoonCard color="bg-white" borderColor={sectionData.borderColor} className="cursor-pointer hover:bg-gray-50" >
                                        <div onClick={() => setMode('learn')} className="h-full flex flex-col items-center justify-center text-center gap-4">
                                            <BookOpen className={`w-16 h-16 ${sectionData.textColor}`} />
                                            <div>
                                                <h3 className="text-2xl font-bold text-gray-800">å­¸ç¿’æ¨¡å¼ (Learn)</h3>
                                                <p className="text-gray-500">å…ˆè¤‡ç¿’ä¸€ä¸‹è¦å‰‡èˆ‡é‡é»</p>
                                            </div>
                                        </div>
                                    </CartoonCard>

                                    <CartoonCard color="bg-white" borderColor={sectionData.borderColor} className="cursor-pointer hover:bg-gray-50">
                                        <div onClick={startQuiz} className="h-full flex flex-col items-center justify-center text-center gap-4">
                                            <Star className={`w-16 h-16 ${sectionData.textColor}`} />
                                            <div>
                                                <h3 className="text-2xl font-bold text-gray-800">æŒ‘æˆ°æ¨¡å¼ (Quiz)</h3>
                                                <p className="text-gray-500">æ¸¬è©¦ä½ çš„å¯¦åŠ›ï¼</p>
                                            </div>
                                        </div>
                                    </CartoonCard>
                                </div>
                            </div>
                        )}

                        {mode === 'learn' && (
                            <div className="space-y-6 animate-in fade-in duration-500">
                                {/* ... Learn Mode Code ... */}
                                <div className="flex items-center gap-4 mb-6">
                                    <div className="bg-white p-3 rounded-full shadow-md border-2 border-gray-100">
                                        <span className="text-4xl">ğŸ‘¨â€ğŸ«</span>
                                    </div>
                                    <div className="bg-white p-4 rounded-r-2xl rounded-bl-2xl shadow-sm border border-gray-100 flex-1 relative">
                                        <div className="absolute top-0 left-0 -ml-2 mt-4 w-4 h-4 bg-white transform rotate-45 border-l border-b border-gray-100"></div>
                                        <p className="text-gray-700 font-bold">é€™æ˜¯é€™ä¸€èª²çš„é‡é»ç­†è¨˜ï¼Œè¨˜å¾—è¦çœ‹æ¸…æ¥šå–”ï¼</p>
                                    </div>
                                </div>

                                {sectionData.rules.map((rule, idx) => (
                                    <CartoonCard key={idx} color="bg-white" borderColor={sectionData.borderColor}>
                                        <h3 className={`text-xl font-black ${sectionData.textColor} mb-3 flex items-center gap-2`}>
                                            <span className="bg-gray-100 text-gray-800 w-8 h-8 rounded-full flex items-center justify-center text-sm">{idx + 1}</span>
                                            {rule.title}
                                        </h3>
                                        <p className="text-gray-700 font-medium mb-4 leading-relaxed whitespace-pre-line">
                                            {rule.content}
                                        </p>
                                        <div className="bg-gray-50 border-l-4 border-gray-300 p-3 italic text-gray-600 rounded-r-lg">
                                            ä¾‹å¥ï¼š {rule.example}
                                        </div>
                                    </CartoonCard>
                                ))}

                                <div className="pt-4 text-center">
                                    <Button onClick={startQuiz} colorClass={sectionData.btnColor} className="w-full md:w-auto text-xl mx-auto">
                                        çœ‹å®Œäº†ï¼Œé–‹å§‹æ¸¬é©—ï¼ <ArrowRight size={24} />
                                    </Button>
                                </div>
                            </div>
                        )}

                        {mode === 'quiz' && !completed && (
                            <div className="max-w-2xl mx-auto animate-in slide-in-from-right-8 duration-300">
                                <div className="mb-8">
                                    <div className="flex justify-between text-sm font-bold text-gray-500 mb-2">
                                        <span>Question {currentQuestionIdx + 1} / {sectionData.questions.length}</span>
                                        <span>Score: {score}</span>
                                    </div>
                                    <div className="h-4 bg-white/50 rounded-full overflow-hidden border border-white/60">
                                        <div 
                                            className={`h-full ${sectionData.btnColor.split(' ')[0]} transition-all duration-500`}
                                            style={{ width: `${((currentQuestionIdx + 1) / sectionData.questions.length) * 100}%` }}
                                        ></div>
                                    </div>
                                </div>

                                <CartoonCard color="bg-white" borderColor={sectionData.borderColor} className="py-12">
                                    <div className="text-center mb-8">
                                        <span className="inline-block bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-bold tracking-wider mb-4 uppercase">
                                            Fill in the blank
                                        </span>
                                        <h3 className="text-2xl md:text-3xl font-bold text-gray-800 leading-normal">
                                            {sectionData.questions[currentQuestionIdx].q.split('__________').map((part, i, arr) => (
                                                <React.Fragment key={i}>
                                                    {part}
                                                    {i < arr.length - 1 && (
                                                        <span className="inline-block px-2">
                                                            <input
                                                                type="text"
                                                                value={userInput}
                                                                onChange={(e) => setUserInput(e.target.value)}
                                                                onKeyDown={(e) => e.key === 'Enter' && checkAnswer()}
                                                                className="border-b-4 border-gray-300 bg-gray-50 text-center w-40 md:w-56 focus:outline-none focus:border-blue-500 text-blue-600 font-handwriting px-2 py-1 transition-colors rounded-t-lg"
                                                                placeholder="type here..."
                                                                autoFocus
                                                            />
                                                        </span>
                                                    )}
                                                </React.Fragment>
                                            ))}
                                        </h3>
                                    </div>

                                    <div className="flex justify-center">
                                        <Button 
                                            onClick={checkAnswer} 
                                            colorClass={sectionData.btnColor}
                                            className="w-full md:w-2/3 text-lg"
                                        >
                                            Check Answer <CheckCircle size={24} />
                                        </Button>
                                    </div>
                                </CartoonCard>
                            </div>
                        )}

                        {completed && (
                            <div className="text-center animate-in zoom-in-90 duration-500 flex flex-col items-center">
                                {/* é¡¯ç¤ºå¯åˆ—å°çš„æˆç¸¾å–® */}
                                <div 
                                    ref={reportRef}
                                    className={`bg-white p-8 rounded-3xl shadow-xl border-8 ${sectionData.borderColor} max-w-sm w-full mb-8 relative overflow-hidden`}
                                >
                                    <div className={`absolute top-0 left-0 w-full h-4 ${sectionData.color}`}></div>
                                    <div className="text-center mb-6">
                                        <span className="text-6xl mb-2 block">
                                            {score === sectionData.questions.length ? 'ğŸ†' : score > sectionData.questions.length / 2 ? 'ğŸŒŸ' : 'ğŸ’ª'}
                                        </span>
                                        <h3 className="text-2xl font-black text-gray-800 uppercase tracking-widest border-b-2 border-gray-100 pb-2">Certificate</h3>
                                    </div>
                                    
                                    <div className="space-y-4 mb-8">
                                        <div>
                                            <p className="text-xs text-gray-400 uppercase font-bold">Student Name</p>
                                            <div className="flex items-center justify-center gap-2">
                                                <h2 className="text-3xl font-handwriting font-bold text-gray-800">{userName}</h2>
                                                <button onClick={() => {
                                                    const newName = prompt("Edit name:", userName);
                                                    if (newName) setUserName(newName);
                                                }} className="text-gray-300 hover:text-gray-500 print:hidden">
                                                    <Edit size={16} />
                                                </button>
                                            </div>
                                        </div>
                                        <div>
                                            <p className="text-xs text-gray-400 uppercase font-bold">Challenge</p>
                                            <p className={`text-lg font-bold ${sectionData.textColor}`}>{sectionData.title}</p>
                                        </div>
                                        <div className="bg-gray-50 p-4 rounded-xl">
                                            <p className="text-xs text-gray-400 uppercase font-bold mb-1">Score</p>
                                            <p className="text-4xl font-black text-gray-800">
                                                {score} <span className="text-lg text-gray-400 font-medium">/ {sectionData.questions.length}</span>
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-gray-400 uppercase font-bold">Date</p>
                                            <p className="text-sm font-medium text-gray-600">{new Date().toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                    
                                    <div className="text-xs text-gray-300 font-bold">
                                        Grammar Adventure App
                                    </div>
                                </div>

                                <div className="flex flex-col md:flex-row gap-4 justify-center w-full max-w-md">
                                    <Button 
                                        onClick={exportResult} 
                                        colorClass="bg-blue-500 hover:bg-blue-600"
                                        className="flex-1"
                                    >
                                        {isExporting ? 'Generating...' : <><Download size={20} /> ä¸‹è¼‰æˆç¸¾å–®</>}
                                    </Button>
                                    <Button onClick={resetQuiz} colorClass="bg-gray-500 hover:bg-gray-600" className="flex-1">
                                        <RefreshCw size={20} /> å†ç©ä¸€æ¬¡
                                    </Button>
                                    <Button onClick={handleGoHome} colorClass={sectionData.btnColor} className="flex-1">
                                        <Home size={20} /> å›åˆ°å¤§å»³
                                    </Button>
                                </div>
                            </div>
                        )}

                        {showFeedback && (
                            <FeedbackModal 
                                isCorrect={lastResult.correct} 
                                correctAnswer={lastResult.answer} 
                                onNext={nextQuestion} 
                            />
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>